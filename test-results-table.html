<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results Table Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0f1a;
            color: #e5e7eb;
            font-family: system-ui, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Mock data similar to what the API returns
        const mockSchedules = [
            {
                id: "test-001",
                origin: "Alexandria, EG",
                destination: "Tanger, MA",
                etd: "2025-08-20T06:00:00Z",
                eta: "2025-08-22T14:00:00Z",
                vessel: "MSC Mediterranean",
                voyage: "MSC123A",
                imo: "IMO1234567",
                routingType: "Direct",
                transitDays: 2,
                carrier: "MSC",
                service: "Mediterranean Express",
                equipment: "40HC"
            },
            {
                id: "test-002",
                origin: "Damietta, EG",
                destination: "Rotterdam, NL",
                etd: "2025-08-21T08:00:00Z",
                eta: "2025-08-28T16:00:00Z",
                vessel: "CMA CGM Atlantic",
                voyage: "CMA456B",
                imo: "IMO7654321",
                routingType: "Transshipment",
                transitDays: 7,
                carrier: "CMA CGM",
                service: "Europe Express",
                equipment: "40RF"
            }
        ];

        // Inline ResultsTable component for testing
        function ResultsTable({ schedules, loading, error, total }) {
            const [expandedRows, setExpandedRows] = React.useState(new Set());

            const toggleRowExpansion = (scheduleId) => {
                const newExpanded = new Set(expandedRows);
                if (newExpanded.has(scheduleId)) {
                    newExpanded.delete(scheduleId);
                } else {
                    newExpanded.add(scheduleId);
                }
                setExpandedRows(newExpanded);
            };

            const extractLocode = (location) => {
                const locodeMap = {
                    "Alexandria, EG": "EGALY",
                    "Tanger, MA": "MATNG", 
                    "Rotterdam, NL": "NLRTM",
                    "Damietta, EG": "EGDAM",
                    "Valencia, ES": "ESVLC",
                };
                return locodeMap[location] || location.split(',')[0].slice(0, 5).toUpperCase();
            };

            const extractCarrierScac = (carrier) => {
                const scacMap = {
                    "CMA CGM": "CMAU",
                    "MSC": "MSCU", 
                    "Hapag-Lloyd": "HLCU",
                    "Ocean Network Express": "ONEY",
                    "Maersk": "MAEU",
                    "COSCO": "COSU",
                };
                return scacMap[carrier] || carrier.slice(0, 4).toUpperCase();
            };

            const generateMockLegs = (schedule) => {
                if (schedule.routingType === "Direct") {
                    return [
                        {
                            from: schedule.origin,
                            to: schedule.destination,
                            etd: schedule.etd,
                            eta: schedule.eta,
                            vessel: schedule.vessel,
                            voyage: schedule.voyage,
                        }
                    ];
                } else {
                    const midDate = new Date(schedule.etd);
                    midDate.setDate(midDate.getDate() + Math.floor(schedule.transitDays / 2));
                    const midEta = midDate.toISOString();
                    
                    midDate.setHours(midDate.getHours() + 6);
                    const midEtd = midDate.toISOString();
                    
                    return [
                        {
                            from: schedule.origin,
                            to: "Singapore, SG",
                            etd: schedule.etd,
                            eta: midEta,
                            vessel: schedule.vessel,
                            voyage: schedule.voyage,
                        },
                        {
                            from: "Singapore, SG",
                            to: schedule.destination,
                            etd: midEtd,
                            eta: schedule.eta,
                            vessel: `${schedule.vessel}-2`,
                            voyage: `${schedule.voyage}B`,
                        }
                    ];
                }
            };

            const formatDate = (isoString) => {
                try {
                    return new Date(isoString).toLocaleDateString();
                } catch {
                    return isoString;
                }
            };

            const formatDateTime = (isoString) => {
                try {
                    const date = new Date(isoString);
                    return date.toLocaleDateString() + " " + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                } catch {
                    return isoString;
                }
            };

            if (loading) {
                return React.createElement("div", {
                    style: { 
                        textAlign: "center", 
                        padding: "48px", 
                        color: "#94a3b8", 
                        fontSize: "16px",
                        background: "#0b1222",
                        border: "1px solid rgba(255,255,255,.12)",
                        borderRadius: 12,
                    }
                }, "Loading schedules...");
            }

            if (error) {
                return React.createElement("div", {
                    style: {
                        textAlign: "center",
                        padding: "48px",
                        color: "#ef4444",
                        fontSize: "16px",
                        background: "#0b1222",
                        border: "1px solid rgba(239, 68, 68, 0.3)",
                        borderRadius: 12,
                    }
                }, `Error: ${error}`);
            }

            if (schedules.length === 0) {
                return React.createElement("div", {
                    style: {
                        textAlign: "center",
                        padding: "48px",
                        color: "#94a3b8",
                        fontSize: "16px",
                        background: "#0b1222",
                        border: "1px solid rgba(255,255,255,.12)",
                        borderRadius: 12,
                    }
                }, "No schedules found");
            }

            const tableContainerStyle = {
                overflowX: "auto",
                maxHeight: "70vh",
                overflowY: "auto",
                border: "1px solid rgba(255,255,255,.12)",
                borderRadius: 12,
                background: "#0b1222",
            };

            const tableStyle = {
                width: "100%",
                borderCollapse: "collapse",
                background: "transparent",
            };

            const thStyle = {
                position: "sticky",
                top: 0,
                background: "#1e293b",
                color: "#f1f5f9",
                padding: "12px",
                textAlign: "left",
                fontWeight: 600,
                fontSize: "14px",
                borderBottom: "1px solid rgba(255,255,255,.12)",
                zIndex: 10,
                whiteSpace: "nowrap",
            };

            const tdStyle = {
                padding: "12px",
                borderBottom: "1px solid rgba(255,255,255,.06)",
                fontSize: "14px",
                verticalAlign: "top",
                color: "#e5e7eb",
            };

            const expanderButtonStyle = {
                background: "transparent",
                border: "none",
                color: "#3b82f6",
                cursor: "pointer",
                padding: "4px",
                borderRadius: 4,
                marginRight: 8,
                fontSize: "12px",
                fontWeight: 600,
            };

            return React.createElement("div", null,
                total !== undefined && React.createElement("div", {
                    style: { 
                        marginBottom: "16px", 
                        fontSize: "14px", 
                        color: "#94a3b8",
                        display: "flex",
                        justifyContent: "space-between",
                        alignItems: "center",
                    }
                }, 
                React.createElement("span", null, `Showing ${schedules.length} of ${total} schedules`),
                React.createElement("span", { style: { fontSize: "12px" } }, "Click rows to expand leg details")
                ),
                React.createElement("div", { style: tableContainerStyle },
                    React.createElement("table", { style: tableStyle },
                        React.createElement("thead", null,
                            React.createElement("tr", null,
                                React.createElement("th", { style: thStyle }, "Actions"),
                                React.createElement("th", { style: thStyle }, "Departure (LOCODE)"),
                                React.createElement("th", { style: thStyle }, "Arrival (LOCODE)"),
                                React.createElement("th", { style: thStyle }, "Carrier+SCAC"),
                                React.createElement("th", { style: thStyle }, "Service"),
                                React.createElement("th", { style: thStyle }, "Vessel/Voyage/IMO"),
                                React.createElement("th", { style: thStyle }, "ETD"),
                                React.createElement("th", { style: thStyle }, "ETA"),
                                React.createElement("th", { style: thStyle }, "Transit (days)"),
                                React.createElement("th", { style: thStyle }, "Routing")
                            )
                        ),
                        React.createElement("tbody", null,
                            schedules.map((schedule) => {
                                const isExpanded = expandedRows.has(schedule.id);
                                const legs = generateMockLegs(schedule);
                                
                                return [
                                    React.createElement("tr", { 
                                        key: schedule.id,
                                        style: { cursor: "pointer" },
                                        onClick: () => toggleRowExpansion(schedule.id)
                                    },
                                        React.createElement("td", { style: tdStyle },
                                            React.createElement("button", {
                                                style: expanderButtonStyle,
                                                onClick: (e) => {
                                                    e.stopPropagation();
                                                    toggleRowExpansion(schedule.id);
                                                }
                                            }, isExpanded ? "▼" : "▶")
                                        ),
                                        React.createElement("td", { style: tdStyle },
                                            React.createElement("div", null, schedule.origin),
                                            React.createElement("div", { 
                                                style: { fontSize: "12px", color: "#94a3b8", fontFamily: "monospace" }
                                            }, extractLocode(schedule.origin))
                                        ),
                                        React.createElement("td", { style: tdStyle },
                                            React.createElement("div", null, schedule.destination),
                                            React.createElement("div", { 
                                                style: { fontSize: "12px", color: "#94a3b8", fontFamily: "monospace" }
                                            }, extractLocode(schedule.destination))
                                        ),
                                        React.createElement("td", { style: tdStyle },
                                            React.createElement("div", null, schedule.carrier),
                                            React.createElement("div", { 
                                                style: { fontSize: "12px", color: "#94a3b8", fontFamily: "monospace" }
                                            }, extractCarrierScac(schedule.carrier))
                                        ),
                                        React.createElement("td", { style: tdStyle }, schedule.service || "-"),
                                        React.createElement("td", { style: tdStyle },
                                            React.createElement("div", null, schedule.vessel),
                                            React.createElement("div", { 
                                                style: { fontSize: "12px", color: "#94a3b8" }
                                            }, `Voyage: ${schedule.voyage}`),
                                            schedule.imo && React.createElement("div", { 
                                                style: { fontSize: "12px", color: "#94a3b8", fontFamily: "monospace" }
                                            }, `IMO: ${schedule.imo}`)
                                        ),
                                        React.createElement("td", { style: tdStyle }, formatDate(schedule.etd)),
                                        React.createElement("td", { style: tdStyle }, formatDate(schedule.eta)),
                                        React.createElement("td", { style: tdStyle },
                                            React.createElement("span", { style: { fontWeight: 600 } }, schedule.transitDays)
                                        ),
                                        React.createElement("td", { style: tdStyle },
                                            React.createElement("span", { 
                                                style: { 
                                                    color: schedule.routingType === "Direct" ? "#10b981" : "#f59e0b",
                                                    fontWeight: 500,
                                                }
                                            }, schedule.routingType)
                                        )
                                    ),
                                    
                                    isExpanded && React.createElement("tr", { key: `${schedule.id}-expanded` },
                                        React.createElement("td", { 
                                            colSpan: 10, 
                                            style: {
                                                ...tdStyle,
                                                background: "#0f172a",
                                                borderLeft: "3px solid #3b82f6",
                                            }
                                        },
                                            React.createElement("div", { style: { padding: "8px" } },
                                                React.createElement("h4", { 
                                                    style: { 
                                                        margin: "0 0 12px 0", 
                                                        color: "#3b82f6", 
                                                        fontSize: "14px",
                                                        fontWeight: 600,
                                                    }
                                                }, `Journey Legs (${legs.length} leg${legs.length !== 1 ? 's' : ''})`),
                                                
                                                React.createElement("table", { 
                                                    style: { width: "100%", borderCollapse: "collapse", marginTop: 8 }
                                                },
                                                    React.createElement("thead", null,
                                                        React.createElement("tr", null,
                                                            React.createElement("th", { style: { background: "#374151", color: "#d1d5db", padding: "8px", textAlign: "left", fontWeight: 500, fontSize: "12px", borderBottom: "1px solid rgba(255,255,255,.1)" } }, "From"),
                                                            React.createElement("th", { style: { background: "#374151", color: "#d1d5db", padding: "8px", textAlign: "left", fontWeight: 500, fontSize: "12px", borderBottom: "1px solid rgba(255,255,255,.1)" } }, "To"),
                                                            React.createElement("th", { style: { background: "#374151", color: "#d1d5db", padding: "8px", textAlign: "left", fontWeight: 500, fontSize: "12px", borderBottom: "1px solid rgba(255,255,255,.1)" } }, "Vessel"),
                                                            React.createElement("th", { style: { background: "#374151", color: "#d1d5db", padding: "8px", textAlign: "left", fontWeight: 500, fontSize: "12px", borderBottom: "1px solid rgba(255,255,255,.1)" } }, "Voyage"),
                                                            React.createElement("th", { style: { background: "#374151", color: "#d1d5db", padding: "8px", textAlign: "left", fontWeight: 500, fontSize: "12px", borderBottom: "1px solid rgba(255,255,255,.1)" } }, "ETD"),
                                                            React.createElement("th", { style: { background: "#374151", color: "#d1d5db", padding: "8px", textAlign: "left", fontWeight: 500, fontSize: "12px", borderBottom: "1px solid rgba(255,255,255,.1)" } }, "ETA")
                                                        )
                                                    ),
                                                    React.createElement("tbody", null,
                                                        legs.map((leg, index) =>
                                                            React.createElement("tr", { key: index },
                                                                React.createElement("td", { style: { padding: "8px", borderBottom: "1px solid rgba(255,255,255,.05)", fontSize: "12px", color: "#d1d5db" } }, leg.from),
                                                                React.createElement("td", { style: { padding: "8px", borderBottom: "1px solid rgba(255,255,255,.05)", fontSize: "12px", color: "#d1d5db" } }, leg.to),
                                                                React.createElement("td", { style: { padding: "8px", borderBottom: "1px solid rgba(255,255,255,.05)", fontSize: "12px", color: "#d1d5db" } }, leg.vessel || "-"),
                                                                React.createElement("td", { style: { padding: "8px", borderBottom: "1px solid rgba(255,255,255,.05)", fontSize: "12px", color: "#d1d5db" } }, leg.voyage || "-"),
                                                                React.createElement("td", { style: { padding: "8px", borderBottom: "1px solid rgba(255,255,255,.05)", fontSize: "12px", color: "#d1d5db" } }, formatDateTime(leg.etd)),
                                                                React.createElement("td", { style: { padding: "8px", borderBottom: "1px solid rgba(255,255,255,.05)", fontSize: "12px", color: "#d1d5db" } }, formatDateTime(leg.eta))
                                                            )
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                                ].filter(Boolean);
                            }).flat()
                        )
                    )
                )
            );
        }

        function TestApp() {
            const [testState, setTestState] = React.useState('loading');
            
            React.useEffect(() => {
                setTimeout(() => setTestState('loaded'), 2000);
            }, []);

            return React.createElement("div", null,
                React.createElement("h1", { style: { marginBottom: "24px", fontSize: "28px", fontWeight: 700 } }, "ResultsTable Component Test"),
                
                React.createElement("div", { style: { marginBottom: "32px" } },
                    React.createElement("h2", { style: { fontSize: "20px", marginBottom: "16px", color: "#3b82f6" } }, "Loading State Test"),
                    React.createElement(ResultsTable, {
                        schedules: [],
                        loading: testState === 'loading',
                        error: null,
                        total: 0
                    })
                ),

                testState === 'loaded' && React.createElement("div", { style: { marginBottom: "32px" } },
                    React.createElement("h2", { style: { fontSize: "20px", marginBottom: "16px", color: "#3b82f6" } }, "Data State Test"),
                    React.createElement(ResultsTable, {
                        schedules: mockSchedules,
                        loading: false,
                        error: null,
                        total: mockSchedules.length
                    })
                ),

                testState === 'loaded' && React.createElement("div", { style: { marginBottom: "32px" } },
                    React.createElement("h2", { style: { fontSize: "20px", marginBottom: "16px", color: "#ef4444" } }, "Error State Test"),
                    React.createElement(ResultsTable, {
                        schedules: [],
                        loading: false,
                        error: "Failed to fetch schedules from API",
                        total: 0
                    })
                ),

                testState === 'loaded' && React.createElement("div", { style: { marginBottom: "32px" } },
                    React.createElement("h2", { style: { fontSize: "20px", marginBottom: "16px", color: "#94a3b8" } }, "Empty State Test"),
                    React.createElement(ResultsTable, {
                        schedules: [],
                        loading: false,
                        error: null,
                        total: 0
                    })
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(TestApp));
    </script>
</body>
</html>